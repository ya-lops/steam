---
import GameTag from "../GameTag.astro";

interface Props {
  game: {
    name: string;
    description: string;
    releaseDate: string;
    screenshots: string[];
    genres: string[];
  };
  class?: string;
}

const { game, class: className, ...rest } = Astro.props;

// Форматируем дату
const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString("ru-RU", {
    year: "numeric",
    month: "short",
    day: "numeric"
  }).replace("г.", "г.");
};
---

<aside class:list={["app-game-card-tooltip", className]} {...rest}>
  <div class="typo-heading-small">{game.name}</div>

  <p>{game.description}</p>

  <div class="mt-3">Дата выпуска: {formatDate(game.releaseDate)}</div>

  <div class="_tooltip-images">
    {game.screenshots.filter(Boolean).slice(0, 4).map((screenshot, index) => (
      <div class="_tooltip-image" style={`--_i: ${index};`}>
        <img src={screenshot} alt={`${game.name} скриншот ${index + 1}`} loading="lazy"/>
      </div>
    ))}
  </div>

  <div class="flex flex-wrap gap-2">
    {game.genres.slice(0, 3).map((genre) => (
      <GameTag>{genre}</GameTag>
    ))}
  </div>
</aside>

<style>
  .app-game-card-tooltip {
    position: relative;
    width: 340px;
    background: var(--steam-color-bg-footer);
    padding: 10px;
    box-shadow: 0 0 15px black;
    pointer-events: none;
    opacity: 1;
    translate: 0 0;
    transition: 0.25s opacity 0.25s ease;
    transition-property: opacity, translate;

    @starting-style {
      opacity: 0;
      translate: 10px 0;
    }

    &::before {
      content: '';
      position: absolute;
      left: -5px;
      top: 30px;
      width: 10px;
      height: 10px;
      rotate: 45deg;
      background: var(--steam-color-bg-footer);
    }

    ._tooltip-images {
      --_count: 4;
      --_delay: 1s;
      position: relative;
      aspect-ratio: 16 /9;
      margin: 10px 0;
    }

    ._tooltip-image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      animation: showImage calc( var(--_count) * 1s ) steps(1) infinite;
      animation-delay: calc(var(--_i) * var(--_delay));

      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    }
  }

  @keyframes showImage {
    0%,
    25% {
      opacity: 1;
    }
    25%,
    100% {
      opacity: 0;
    }
  }
</style>